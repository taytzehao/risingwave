(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[307],{50361:function(t,e,r){var o=r(85990);t.exports=function(t){return o(t,5)}},31351:function(t){var e=Array.prototype.reverse;t.exports=function(t){return null==t?t:e.call(t)}},6165:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/streaming_graph",function(){return r(5298)}])},4713:function(t,e,r){"use strict";r.d(e,{_P:function(){return a},bK:function(){return l},o:function(){return s},rE:function(){return i}}),r(50361);var o=r(6162),n=r.n(o);function l(t,e,r){let o=function(t){let e=new Map;for(let r of t)e.set(r.id,r);let r=new Map,o=new Map,n=t=>{let l=o.get(t);if(void 0!==l)return l;let i={nextNodes:[]},a=e.get(t);if(void 0===a)throw Error("no such id ".concat(t));for(let t of a.parentIds)n(t).nextNodes.push(i);return o.set(t,i),r.set(i,t),i};for(let e of t)n(e.id);let l=new Map,i=[];for(let t of r.keys())i.push(t);for(let t of function(t){let e=[],r=[],o=new Map,n=t=>{if(t.temp)throw Error("This is not a DAG");if(!t.perm){t.temp=!0;let r=-1;for(let e of t.node.nextNodes){o.get(e).isInput=!1,t.isOutput=!1;let l=n(o.get(e));l>r&&(r=l)}t.temp=!1,t.perm=!0,t.g=r+1,e.unshift(t.node)}return t.g};for(let e of t){let t={node:e,temp:!1,perm:!1,isInput:!0,isOutput:!0,g:0};o.set(e,t),r.push(t)}let l=0;for(let t of r){let e=n(t);e>l&&(l=e)}for(let t of r)t.g=l-t.g;let i=[];for(let t=0;t<l+1;++t)i.push({nodes:[],occupyRow:new Set});let a=new Map,s=new Map;for(let t of r)i[t.g].nodes.push(t.node),a.set(t.node,t.g);let c=(t,e)=>{s.set(t,e),i[a.get(t)].occupyRow.add(e)},f=(t,e,r)=>{for(let o=t;o<=e;++o)i[o].occupyRow.add(r)},u=(t,e)=>i[t].occupyRow.has(e),d=(t,e,r)=>{if(r<0)return!1;for(let o=t;o<=e;++o)if(u(o,r))return!0;return!1};for(let e of t)e.nextNodes.sort((t,e)=>a.get(e)-a.get(t));for(let t of i)for(let e of t.nodes){if(!s.has(e)){for(let t of e.nextNodes){if(s.has(t))continue;let r=-1;for(;d(a.get(e),a.get(t),++r););c(e,r),c(t,r),f(a.get(e)+1,a.get(t)-1,r);break}if(!s.has(e)){let t=-1;for(;u(a.get(e),++t););c(e,t)}}for(let t of e.nextNodes){if(s.has(t))continue;let r=s.get(e);if(!d(a.get(e)+1,a.get(t),r)){c(t,r),f(a.get(e)+1,a.get(t)-1,r);continue}for(r=-1;d(a.get(e)+1,a.get(t),++r););c(t,r),f(a.get(e)+1,a.get(t)-1,r)}}let h=new Map;for(let e of t)h.set(e,[a.get(e),s.get(e)]);return h}(i)){let o=r.get(t[0]);if(!o)throw Error("no corresponding actorboxid of node ".concat(t[0]));let n=e.get(o);if(!n)throw Error("actorbox id ".concat(o," is not present in actorBoxIdToActorBox"));l.set(n,t[1])}return l}(t),l=new Map,i=new Map,a=0,s=0;for(let t of o){let e=t[0],r=t[1][0],o=t[1][1],c=l.get(r)||0;e.width>c&&l.set(r,e.width);let f=i.get(o)||0;e.height>f&&i.set(o,e.height),a=n()([r,a])||0,s=n()([o,s])||0}let c=new Map,f=new Map,u=(t,e,r,o)=>{let n=r.get(t);if(n)return n;if(0===t)n=0;else{let l=o.get(t-1);if(!l)throw Error("".concat(t-1," has no result"));n=u(t-1,e,r,o)+l+e}return r.set(t,n),n};for(let t=0;t<=a;++t)u(t,e,c,l);for(let t=0;t<=s;++t)u(t,r,f,i);let d=[];for(let[t,[e,r]]of o){let o=c.get(e),n=f.get(r);if(void 0!==o&&void 0!==n)d.push({id:t.id,x:o,y:n,data:t});else throw Error("x of layer ".concat(e,": ").concat(o,", y of row ").concat(r,": ").concat(n," "))}return d}function i(t,e,r,o){let n=function(t,e,r,o){let n=[];for(let{id:e,name:r,order:l,parentIds:i,...a}of t)n.push({id:e,name:r,parentIds:i,width:2*o,height:2*o,order:l,...a});let i=l(n,e,r);return i.map(t=>{let{id:e,x:r,y:n,data:l}=t;return{id:e,data:l,x:r+o,y:n+o}})}(t,r,e,o);return n.map(t=>{let{id:e,x:r,y:o,data:n}=t;return{id:e,data:n,x:o,y:r}})}function a(t){let e=[],r=new Map;for(let e of t)r.set(e.id,e);for(let o of t)for(let t of o.data.parentIds){let n=r.get(t);e.push({points:[{x:o.x,y:o.y},{x:n.x,y:n.y}],source:o.id,target:t})}return e}function s(t){let e=[],r=new Map;for(let e of t)r.set(e.id,e);for(let o of t)for(let t of o.data.parentIds){let n=r.get(t);e.push({points:[{x:o.x+o.data.width/2,y:o.y+o.data.height/2},{x:n.x+n.data.width/2,y:n.y+n.data.height/2}],source:o.id,target:t})}return e}},5298:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return b}});var o=r(85893),n=r(66479),l=r(40639),i=r(47741),a=r(31351),s=r.n(a),c=r(89734),f=r.n(c),u=r(9008),d=r.n(u),h=r(41664),g=r.n(h),p=r(11163),x=r(67294),w=r(52189),m=r(79855),y=r(4713);function v(t){let{nodes:e,selectedId:r}=t,n=(0,x.useRef)(),l=(0,x.useCallback)(()=>{let t=(0,y.rE)(e,50,200,10).map(t=>{let{x:e,y:r,...o}=t;return{x:e+100,y:r+100,...o}}),r=(0,y._P)(t),{width:o,height:n}=function(t,e){let r=0,o=0;for(let{x:n,y:l,data:i}of t)r=Math.max(r,n+e),o=Math.max(o,l+e);return{width:r,height:o}}(t,10);return{layoutMap:t,links:r,width:o+200+200,height:n+50+200}},[e]),{layoutMap:i,width:a,height:s,links:c}=l();return(0,x.useEffect)(()=>{let t=n.current,e=m.Ys(t),o=m.ak_,l=m.jvg().curve(o).x(t=>{let{x:e}=t;return e}).y(t=>{let{y:e}=t;return e}),a=e.select(".edges").selectAll(".edge").data(c),s=t=>t===r,f=t=>t.attr("d",t=>{let{points:e}=t;return l(e)}).attr("fill","none").attr("stroke-width",1).attr("stroke-width",t=>s(t.source)||s(t.target)?2:1).attr("opacity",t=>s(t.source)||s(t.target)?1:.5).attr("stroke",t=>s(t.source)||s(t.target)?w.rS.colors.teal["500"]:w.rS.colors.gray["300"]);a.exit().remove(),a.enter().call(t=>t.append("path").attr("class","edge").call(f)),a.call(f);let u=t=>{t.attr("transform",t=>{let{x:e,y:r}=t;return"translate(".concat(e,",").concat(r,")")});let e=t.select("circle");e.empty()&&(e=t.append("circle")),e.attr("r",10).style("cursor","pointer").attr("fill",t=>{let{id:e}=t;return s(e)?w.rS.colors.teal["500"]:w.rS.colors.gray["500"]});let r=t.select("text");return r.empty()&&(r=t.append("text")),r.attr("fill","black").text(t=>{let{data:{name:e}}=t;return e}).attr("font-family","inherit").attr("text-anchor","middle").attr("dy",20).attr("fill","black").attr("font-size",12).attr("transform","rotate(-8)"),t},d=e.select(".boxes"),h=d.selectAll(".node").data(i);h.enter().call(t=>t.append("g").attr("class","node").call(u)),h.call(u),h.exit().remove()},[i,c,r]),(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("svg",{ref:n,width:"".concat(a,"px"),height:"".concat(s,"px"),children:[(0,o.jsx)("g",{className:"edges"}),(0,o.jsx)("g",{className:"boxes"})]})})}var j=r(96756),k=r(67684);function b(){let t=(0,n.pm)(),[e,r]=(0,x.useState)();(0,x.useEffect)(()=>((async function(){try{r(await (0,k.H4)())}catch(e){t({title:"Error Occurred",description:e.toString(),status:"error",duration:5e3,isClosable:!0}),console.error(e)}})(),()=>{}),[t]);let a=(0,x.useCallback)(()=>e?function(t){let e=[],r=new Set(t.map(t=>t.id));for(let o of s()(f()(t,"id")))e.push({id:o.id.toString(),name:o.name,parentIds:(0,k.vx)(o)?o.dependentRelations.filter(t=>r.has(t)).map(t=>t.toString()):[],order:o.id});return e}(e):void 0,[e]),c=a(),u=(0,p.useRouter)(),h=(0,o.jsxs)(l.kC,{p:3,height:"calc(100vh - 20px)",flexDirection:"column",children:[(0,o.jsx)(j.Z,{children:"Streaming Graph"}),(0,o.jsxs)(l.kC,{flexDirection:"row",height:"full",children:[(0,o.jsxs)(l.kC,{width:"200px",height:"full",maxHeight:"full",mr:3,alignItems:"flex-start",flexDirection:"column",children:[(0,o.jsx)(l.xv,{fontWeight:"semibold",mb:3,children:"All Nodes"}),(0,o.jsx)(l.xu,{flex:1,overflowY:"scroll",children:(0,o.jsx)(l.gC,{width:"full",spacing:1,children:null==e?void 0:e.map(t=>{let e=u.query.id===t.id.toString();return(0,o.jsx)(g(),{href:"?id=".concat(t.id),children:(0,o.jsx)(i.zx,{colorScheme:e?"teal":"gray",color:e?"teal.600":"gray.500",variant:e?"outline":"ghost",width:"full",py:0,height:8,justifyContent:"flex-start",children:t.name})},t.id)})})})]}),(0,o.jsxs)(l.xu,{flex:1,height:"full",ml:3,overflowX:"scroll",overflowY:"scroll",children:[(0,o.jsx)(l.xv,{fontWeight:"semibold",children:"Graph"}),c&&(0,o.jsx)(v,{nodes:c,selectedId:u.query.id})]})]})]});return(0,o.jsxs)(x.Fragment,{children:[(0,o.jsx)(d(),{children:(0,o.jsx)("title",{children:"Streaming Graph"})}),h]})}}},function(t){t.O(0,[662,184,591,855,340,575,684,774,888,179],function(){return t(t.s=6165)}),_N_E=t.O()}]);